<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>지원소대 열외조사</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    label {
      display: block;
      margin: 8px 0;
    }
    .result {
      margin-top: 30px;
    }
    .squad-group {
      margin-bottom: 20px;
      padding: 10px;
      border: 2px solid #ccc;
      background-color: #f9f9f9;
    }
    .squad-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .entry {
      margin-bottom: 10px;
      border-bottom: 1px dashed #aaa;
      padding-bottom: 5px;
    }
    .reason-input {
      display: none;
      margin-left: 20px;
      margin-top: 5px;
    }
    #summary {
      margin-top: 30px;
      padding: 15px;
      border: 2px solid #666;
      background-color: #eef;
      max-width: 300px;
    }
    #dateTitle {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <!-- 날짜 표시 -->
  <div id="dateTitle">지원소대 열외조사 - 날짜: </div>

  <form id="infoForm">
    <label>
      이름:
      <input type="text" id="name" name="name" required />
    </label>

    <p>분대를 선택하세요:</p>
    <label><input type="checkbox" name="squad" value="차량" /> 차량</label>
    <label><input type="checkbox" name="squad" value="장비" /> 장비</label>

    <p>열외 내용을 체크해주세요:</p>
    <label>
      <input type="checkbox" name="checks" value="아침 점호 열외" id="morningCheck" />
      아침 점호 열외
    </label>
    <input
      type="text"
      id="morningReason"
      class="reason-input"
      placeholder="열외 사유를 입력하세요"
    />

    <label>
      <input type="checkbox" name="checks" value="일과 열외" id="dayCheck" />
      일과 열외
    </label>
    <input
      type="text"
      id="dayReason"
      class="reason-input"
      placeholder="열외 사유를 입력하세요"
    />

    <label>
      <input type="checkbox" name="checks" value="열외사항 없음" id="noCheck" />
      열외사항 없음
    </label>

    <br /><br />
    <button type="submit">제출</button>
  </form>

  <div class="result" id="result">
    <h3>분대별 입력 정보</h3>

    <div id="squad-차량" class="squad-group">
      <div class="squad-title">🚙 차량 분대</div>
    </div>

    <div id="squad-장비" class="squad-group">
      <div class="squad-title">🔧 장비 분대</div>
    </div>
  </div>

  <div id="summary">
    <h3>열외 통계</h3>
    <p>아침 점호 열외 수: <span id="morningCount">0</span></p>
    <p>일과 열외 수: <span id="dayCount">0</span></p>
  </div>

  <script>
    // 한국시간 기준 오늘 날짜 문자열 구하는 함수 (예: 2025년 09월 27일)
    function getKoreanDateString() {
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset() * 60000;
      const kst = new Date(utc + 9 * 60 * 60000);

      const year = kst.getFullYear();
      const month = String(kst.getMonth() + 1).padStart(2, "0");
      const day = String(kst.getDate()).padStart(2, "0");

      return `${year}년 ${month}월 ${day}일`;
    }

    const dateTitle = document.getElementById("dateTitle");
    let todayDate = getKoreanDateString();
    dateTitle.textContent = `${todayDate} 열외조사`;

    const form = document.getElementById("infoForm");

    const squadCheckboxes = document.querySelectorAll('input[name="squad"]');

    const morningCheck = document.getElementById("morningCheck");
    const dayCheck = document.getElementById("dayCheck");
    const noCheck = document.getElementById("noCheck");

    const morningReason = document.getElementById("morningReason");
    const dayReason = document.getElementById("dayReason");

    // 통계 변수
    let morningCount = 0;
    let dayCount = 0;

    // 통계 요소
    const morningCountSpan = document.getElementById("morningCount");
    const dayCountSpan = document.getElementById("dayCount");

    // 분대 체크박스 라디오처럼 작동
    squadCheckboxes.forEach((cb) => {
      cb.addEventListener("change", function () {
        if (this.checked) {
          squadCheckboxes.forEach((other) => {
            if (other !== this) other.checked = false;
          });
        }
      });
    });

    // 열외 체크박스 & 이유 입력창 토글
    morningCheck.addEventListener("change", function () {
      morningReason.style.display = this.checked ? "block" : "none";
      if (!this.checked) morningReason.value = "";
      if (this.checked) {
        noCheck.checked = false;
        noCheck.disabled = false;
      }
    });

    dayCheck.addEventListener("change", function () {
      dayReason.style.display = this.checked ? "block" : "none";
      if (!this.checked) dayReason.value = "";
      if (this.checked) {
        noCheck.checked = false;
        noCheck.disabled = false;
      }
    });

    noCheck.addEventListener("change", function () {
      if (this.checked) {
        [morningCheck, dayCheck].forEach((cb) => {
          cb.checked = false;
          cb.disabled = true;
        });
        morningReason.style.display = "none";
        morningReason.value = "";
        dayReason.style.display = "none";
        dayReason.value = "";
      } else {
        [morningCheck, dayCheck].forEach((cb) => (cb.disabled = false));
      }
    });

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      // 날짜가 변경되었는지 확인
      const currentDate = getKoreanDateString();
      if (currentDate !== todayDate) {
        // 날짜 변경시 데이터 초기화
        resetData();
        todayDate = currentDate;
        dateTitle.textContent = `${todayDate} 열외조사`;
      }

      const name = document.getElementById("name").value.trim();
      const selectedSquad = document.querySelector('input[name="squad"]:checked');
      const squad = selectedSquad ? selectedSquad.value : null;

      if (!name || !squad) {
        alert("이름과 분대를 모두 입력해주세요.");
        return;
      }

      const checkedBoxes = document.querySelectorAll('input[name="checks"]:checked');
      if (checkedBoxes.length === 0) {
        alert("열외 내용을 한 개 이상 선택해주세요.");
        return;
      }

      let detailList = [];
      if (noCheck.checked) {
        detailList = ["열외사항 없음"];
      } else {
        if (morningCheck.checked) {
          const reason = morningReason.value.trim() || "사유 없음";
          detailList.push(`아침 점호 열외 (${reason})`);
          morningCount++;
        }
        if (dayCheck.checked) {
          const reason = dayReason.value.trim() || "사유 없음";
          detailList.push(`일과 열외 (${reason})`);
          dayCount++;
        }
      }

      // 결과 출력
      const entryDiv = document.createElement("div");
      entryDiv.className = "entry";
      entryDiv.innerHTML = `
        <strong>이름:</strong> ${name}<br>
        <strong>열외 내용:</strong> ${detailList.join(", ")}
      `;

      const squadContainer = document.getElementById("squad-" + squad);
      if (squadContainer) {
        squadContainer.appendChild(entryDiv);
      } else {
        alert("분대 출력 영역을 찾을 수 없습니다.");
      }

      // 통계 업데이트
      morningCountSpan.textContent = morningCount;
      dayCountSpan.textContent = dayCount;

      form.reset();

      // 이유 입력창 숨기기 초기화
      morningReason.style.display = "none";
      dayReason.style.display = "none";

      // 체크박스 상태 초기화 - 분대
      squadCheckboxes.forEach((cb) => {
        cb.checked = false;
        cb.disabled = false;
      });

      // 열외사항 체크박스 상태 초기화
      [morningCheck, dayCheck, noCheck].forEach((cb) => {
        cb.checked = false;
        cb.disabled = false;
      });

      morningReason.value = "";
      dayReason.value = "";
    });

    // 데이터 초기화 함수
    function resetData() {
      morningCount = 0;
      dayCount = 0;
      morningCountSpan.textContent = "0";
      dayCountSpan.textContent = "0";

      // 분대별 입력 정보 초기화
      const vehicleSquad = document.getElementById("squad-차량");
      const equipmentSquad = document.getElementById("squad-장비");

      // .entry만 삭제 (분대 타이틀은 남김)
      Array.from(vehicleSquad.querySelectorAll(".entry")).forEach((el) => el.remove());
      Array.from(equipmentSquad.querySelectorAll(".entry")).forEach((el) => el.remove());
    }

    // 페이지 로드 후 1분마다 날짜 체크해서 바뀌면 초기화
    setInterval(() => {
      const currentDate = getKoreanDateString();
      if (currentDate !== todayDate) {
        resetData();
        todayDate = currentDate;
        dateTitle.textContent = `${todayDate} 열외조사`;
      }
    }, 600000); // 60000ms = 1분
  </script>
</body>
</html>






